"use strict";function e(e){return"function"==typeof e?e():e}function t(e){return!a(e)&&(n(e)||i(e)||r(e))}function n(e){return e.hasOwnProperty("action")}function i(e){return e.hasOwnProperty("href")}function o(e){return e.hasOwnProperty("isDivider")}function r(e){return e.hasOwnProperty("subMenu")}function a(e){return e.hasOwnProperty("html")||e.hasOwnProperty("element")}function d(e){return!t(e)&&!o(e)&&!a(e)}function c(n){return t(n)&&e(n.disabled)||r(n)&&0===e(n.subMenu).length}function u(e,t){var n;e.addEventListener("mouseenter",(function(e){n=setTimeout((function(){return t(e)}),150)})),e.addEventListener("mouseleave",(function(){return clearTimeout(n)}))}function s(n){var i,a=document.createElement("li");return function(e,t,n){e.filter((function(e){return(0,e[0])(t)})).every((function(e){e[0];var t=e[1],i=e[2];return!void n.classList.add(t)&&i}))}([[o,"divider",!1],[function(e){return e.icon},"icon",!0],[d,"heading",!1],[r,"submenu",!0],[c,"disabled",!1],[t,"interactive",!0]],n,a),o(n)||(Object.entries(null!==(i=e(n.attributes))&&void 0!==i?i:{}).forEach((function(e){var t=e[0],n=e[1];return a.setAttribute(t,n)})),[l,h,f,v,p].forEach((function(e){return e.call(null,n,a)}))),a}function l(t,n){var i,o=t.html,r=t.text,a=e(t.element);a?n.append(a):n.innerHTML=null!==(i=e(o))&&void 0!==i?i:"<span>".concat(e(r),"</span>")}function h(t,n){var i=t.tooltip,o=t.style;n.title=e(i)||"",o&&n.setAttribute("style",e(o))}function f(t,n){var i=t.icon;i&&(n.innerHTML+='<img class="icon" src="'.concat(e(i),'" />'))}function v(i,o){for(var a=0,d=Object.entries(e(i.events)||{});a<d.length;a++){var u=d[a],s=u[0],l=u[1],h="function"==typeof l?{listener:l,options:{}}:l,f=h.listener,v=h.options;o.addEventListener(s,f,v)}o.addEventListener("click",(function(e){c(i)||r(i)||(n(i)&&i.action(e),t(i)&&E.hide())}))}function p(t,n){if(i(t)&&!c(t)){var o=t.href,r=t.download,a=t.target,d=document.createElement("a");d.innerHTML=n.innerHTML,d.href=e(o),void 0!==r&&(d.download=e(r)),a&&(d.target=e(a)),n.replaceChildren(d)}}Object.defineProperty(exports,"__esModule",{value:!0});var m="r",x="d";function y(e,t){var n=w(),i=window.visualViewport,o=i.width,r=i.height;Object.assign(e.style,{maxHeight:r/n.y+"px",maxWidth:o/n.x+"px"});var a=function(e){var t=e.cloneNode(!0);t.style.visibility="hidden",document.body.appendChild(t);var n=b(t);return document.body.removeChild(t),n}(e);a.width=Math.trunc(a.width)+1,a.height=Math.trunc(a.height)+1;var d={x:0,y:0};if(t instanceof Element){var c=b(t),u=c.x,s=c.width,l=c.y;d={x:"r"===m?u+s:u-a.width,y:l},t.className.includes("submenu")&&(d.y+="d"===x?4:-12);var h=g(a,d);d.x!==h.x&&(m="r"===m?"l":"r",d.x="r"===m?u+s:u-a.width),d.y!==h.y&&(x="u"===x?"d":"u",d.y=h.y),d=g(a,d)}else{var f=""!==document.body.style.transform?document.body.getBoundingClientRect():{x:0,y:0};d=g(a,{x:(t.clientX-f.x)/n.x,y:(t.clientY-f.y)/n.y})}Object.assign(e.style,{left:d.x+"px",top:d.y+"px",width:a.width+"px",height:a.height+"px"})}function g(e,t){var n=window.visualViewport,i=n.width,o=n.height,r=""!==document.body.style.transform?document.body.getBoundingClientRect():{left:0,top:0},a=r.left,d=r.top,c=w(),u=-a/c.x,s=-d/c.y,l=(i-a)/c.x,h=(o-d)/c.y;return{x:"r"===m?t.x+e.width>l?l-e.width:t.x:t.x<u?u:t.x,y:"d"===x?t.y+e.height>h?h-e.height:t.y:t.y<s?s:t.y+e.height>h?h-e.height:t.y}}function b(e){var t=e.offsetLeft,n=e.offsetTop,i=e.offsetHeight,o=e.offsetWidth;if(e.offsetParent instanceof HTMLElement){var r=b(e.offsetParent);return{x:t+r.x,y:n+r.y,width:o,height:i}}return{x:t,y:n,width:o,height:i}}function w(){var e=document.body,t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth,y:t.height/e.offsetHeight}}var E=function(){function t(){var e=this;this.cache={},this.preventCloseOnScroll=!1;var n=function(){e.hide()};window.addEventListener("click",n),window.addEventListener("resize",n);var i=0;window.addEventListener("wheel",(function(){clearTimeout(i),i=setTimeout((function(){e.preventCloseOnScroll?e.preventCloseOnScroll=!1:e.hide()}))}),{passive:!0}),window.addEventListener("keydown",(function(t){"Escape"===t.key&&e.hide()})),t.addStylesToDom()}return t.getInstance=function(){t.instance||(t.instance=new t);var e=t.instance;return{attach:e.attach.bind(e),delete:e.delete.bind(e),hide:e.hide.bind(e),show:e.show.bind(e),update:e.update.bind(e)}},t.prototype.attach=function(e,t,n){var i=this;void 0===n&&(n={});var o=this.getConfig(n),r=document.querySelector(e);if(void 0===this.cache[e])if(r){var a=function(e){i.show(t,e,o)};this.cache[e]={ctxMenu:t,handler:a,config:o},r.addEventListener("contextmenu",a)}else console.error("target element ".concat(e," not found"));else console.error("target element ".concat(e," already has a context menu assigned. Use ContextMenu.update() intstead."))},t.prototype.update=function(e,t,n){void 0===n&&(n={});var i=this.cache[e],o=Object.assign({},null==i?void 0:i.config,n),r=document.querySelector(e);i&&(null==r||r.removeEventListener("contextmenu",i.handler)),delete this.cache[e],this.attach(e,t||(null==i?void 0:i.ctxMenu)||[],o)},t.prototype.delete=function(e){var t=this.cache[e];if(!t)return console.error("no context menu for target element ".concat(e," found"));delete this.cache[e];var n=document.querySelector(e);if(!n)return console.error("target element ".concat(e," does not exist (anymore)"));n.removeEventListener("contextmenu",t.handler)},t.prototype.show=function(e,t,n){var i,o,r,a=this;t instanceof MouseEvent&&(t.stopImmediatePropagation(),t.preventDefault()),this.hide();var d=this.getConfig(n);this.onHide=d.onHide,this.onBeforeHide=d.onBeforeHide;var c=null!==(o=null===(i=d.onBeforeShow)||void 0===i?void 0:i.call(d,e.slice(),t instanceof MouseEvent?t:void 0))&&void 0!==o?o:e;this.menu=this.generateDOM(c,t,d.attributes),document.body.appendChild(this.menu),null===(r=d.onShow)||void 0===r||r.call(d,this.menu),this.menu.addEventListener("wheel",(function(){a.preventCloseOnScroll=!0}),{passive:!0})},t.prototype.hide=function(e){var t,n;void 0===e&&(e=this.menu),null===(t=this.onBeforeHide)||void 0===t||t.call(this,e),m="r",x="d",e&&(e===this.menu&&delete this.menu,e.remove(),null===(n=this.onHide)||void 0===n||n.call(this,e),this.onBeforeHide=void 0,this.onHide=void 0)},t.prototype.getConfig=function(e){return void 0===e&&(e={}),Object.assign({onBeforeShow:function(e){return e},onBeforeHide:function(){},onShow:function(){},onHide:function(){}},e)},t.prototype.generateDOM=function(t,n,i){var o=this;void 0===i&&(i={});var a=function(e){var t=document.createElement("ul");t.className="ctxmenu",t.append.apply(t,e.map(s)),0===e.length&&(t.style.display="none");var n=function(e){e.stopPropagation(),e.preventDefault()};return t.addEventListener("contextmenu",n),t.addEventListener("click",n),t}(t);return y(a,n),t.forEach((function(t,n){var i=a.children[n];u(i,(function(){var e,t=null===(e=i.parentElement)||void 0===e?void 0:e.querySelector("ul");t&&t.parentElement!==i&&o.hide(t)})),c(t)||r(t)&&u(i,(function(){i.querySelector("ul")||i.appendChild(o.generateDOM(e(t.subMenu),i,e(t.subMenuAttributes)))}))})),Object.entries(i).forEach((function(e){var t=e[0],n=e[1];return a.setAttribute(t,n)})),a},t.addStylesToDom=function(){if("loading"===document.readyState)return document.addEventListener("readystatechange",this.addStylesToDom,{once:!0});var e=document.createElement("style");e.innerHTML='html{min-height:100%}.ctxmenu{position:fixed;border:1px solid #999;padding:2px 0;box-shadow:#aaa 3px 3px 3px;background:#fff;margin:0;z-index:9999;overflow-y:auto;font:15px Verdana,sans-serif;box-sizing:border-box}.ctxmenu li{margin:1px 0;display:block;position:relative;user-select:none}.ctxmenu li.heading{font-weight:bold;margin-left:-5px}.ctxmenu li span{display:block;padding:2px 20px;cursor:default}.ctxmenu li a{color:inherit;text-decoration:none}.ctxmenu li.icon{padding-left:15px}.ctxmenu img.icon{position:absolute;width:18px;left:10px;top:2px}.ctxmenu li.disabled{color:#ccc}.ctxmenu li.divider{border-bottom:1px solid #aaa;margin:5px 0}.ctxmenu li.interactive:hover{background:rgba(0,0,0,.1)}.ctxmenu li.submenu::after{content:"";position:absolute;display:block;top:0;bottom:0;right:.4em;margin:auto .1rem auto auto;border:solid #000;border-width:1px 1px 0 0;transform:rotate(45deg);width:.3rem;height:.3rem}.ctxmenu li.submenu.disabled::after{border-color:#ccc}',document.head.insertBefore(e,document.head.childNodes[0])},t}().getInstance();
/*! ctxMenu v1.7.0 | (c) Nikolaj Kappler | https://github.com/nkappler/ctxmenu/blob/master/LICENSE !*/exports.ctxmenu=E;
