"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){return e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};function t(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))}function n(e){return"function"==typeof e?e():e}function o(e){return i(e)||r(e)||a(e)||function(e){return e.hasOwnProperty("html")||e.hasOwnProperty("element")}(e)}function i(e){return e.hasOwnProperty("action")}function r(e){return e.hasOwnProperty("href")}function a(e){return e.hasOwnProperty("subMenu")}function d(e,t){var n;e.addEventListener("mouseenter",(function(e){n=setTimeout((function(){return t(e)}),150)})),e.addEventListener("mouseleave",(function(){return clearTimeout(n)}))}function c(e){return n(e.disabled)||a(e)&&"function"!=typeof e.subMenu&&0===e.subMenu.length}function s(e){var t=document.createElement("li");if(function(e){return e.hasOwnProperty("isDivider")}(e))return t.className="divider",t;if(function(e,t){var o=n(e.html),i="<span>".concat(n(e.text),"</span>"),r=n(e.element);r?t.append(r):t.innerHTML=o||i,t.title=n(e.tooltip)||"",e.style&&t.setAttribute("style",n(e.style));e.icon&&(t.classList.add("icon"),t.innerHTML+='<img class="icon" src="'.concat(n(e.icon),'" />'));for(var a=0,d=Object.entries(n(e.events)||{});a<d.length;a++){var c=d[a],s=c[0],u=c[1],l="function"==typeof u?{listener:u,options:{}}:u,h=l.listener,f=l.options;t.addEventListener(s,h,f)}}(e,t),!o(e))return t.classList.add("heading"),t;if(c(e))return t.classList.add("disabled"),a(e)&&t.classList.add("submenu"),t;if(t.classList.add("interactive"),r(e)){var d=document.createElement("a");return d.append.apply(d,Array.from(t.childNodes)),d.href=n(e.href),e.hasOwnProperty("download")&&(d.download=n(e.download)),e.hasOwnProperty("target")&&(d.target=n(e.target)),t.append(d),t}return i(e)?(t.addEventListener("click",e.action),t):(t.classList.add("submenu"),t)}"function"==typeof SuppressedError&&SuppressedError;var u="r",l="d";function h(e,t){var n=m(),o=window.visualViewport,i=o.width,r=o.height;Object.assign(e.style,{maxHeight:r/n.y+"px",maxWidth:i/n.x+"px"});var a=function(e){var t=e.cloneNode(!0);t.style.visibility="hidden",document.body.appendChild(t);var n=p(t);return document.body.removeChild(t),n}(e);a.width=Math.trunc(a.width)+1,a.height=Math.trunc(a.height)+1;var d={x:0,y:0};if(t instanceof Element){var c=p(t),s=c.x,h=c.width,v=c.y;d={x:"r"===u?s+h:s-a.width,y:v},t.className.includes("submenu")&&(d.y+="d"===l?4:-12);var y=f(a,d);d.x!==y.x&&(u="r"===u?"l":"r",d.x="r"===u?s+h:s-a.width),d.y!==y.y&&(l="u"===l?"d":"u",d.y=y.y),d=f(a,d)}else{var g=""!==document.body.style.transform?document.body.getBoundingClientRect():{x:0,y:0};d=f(a,{x:(t.clientX-g.x)/n.x,y:(t.clientY-g.y)/n.y})}Object.assign(e.style,{left:d.x+"px",top:d.y+"px",width:a.width+"px",height:a.height+"px"})}function f(e,t){var n=window.visualViewport,o=n.width,i=n.height,r=""!==document.body.style.transform?document.body.getBoundingClientRect():{left:0,top:0},a=r.left,d=r.top,c=m(),s=-a/c.x,h=-d/c.y,f=(o-a)/c.x,p=(i-d)/c.y;return{x:"r"===u?t.x+e.width>f?f-e.width:t.x:t.x<s?s:t.x,y:"d"===l?t.y+e.height>p?p-e.height:t.y:t.y<h?h:t.y+e.height>p?p-e.height:t.y}}function p(e){var t=e.offsetLeft,n=e.offsetTop,o=e.offsetHeight,i=e.offsetWidth;if(e.offsetParent instanceof HTMLElement){var r=p(e.offsetParent);return{x:t+r.x,y:n+r.y,width:i,height:o}}return{x:t,y:n,width:i,height:o}}function m(){var e=document.body,t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth,y:t.height/e.offsetHeight}}var v=function(){function i(){var e=this;this.cache={},this.preventCloseOnScroll=!1,window.addEventListener("click",(function(t){var n=t.target instanceof Element&&t.target.parentElement;n&&"interactive"===n.className||e.hide()})),window.addEventListener("resize",(function(){e.hide()}));var t=0;window.addEventListener("wheel",(function(){clearTimeout(t),t=setTimeout((function(){e.preventCloseOnScroll?e.preventCloseOnScroll=!1:e.hide()}))}),{passive:!0}),window.addEventListener("keydown",(function(t){"Escape"===t.key&&e.hide()})),i.addStylesToDom()}return i.getInstance=function(){i.instance||(i.instance=new i);var e=i.instance;return{attach:e.attach.bind(e),delete:e.delete.bind(e),hide:e.hide.bind(e),show:e.show.bind(e),update:e.update.bind(e)}},i.prototype.attach=function(e,n,o){var i=this;if(void 0===o&&(o={}),"function"==typeof o)return this.attach(e,n,{onBeforeShow:o});var r=this.getConfig(o),a=document.querySelector(e);if(void 0===this.cache[e])if(a){var d=function(e){var o=r.onBeforeShow(t([],n,!0),e);i.show(o,e,r)};this.cache[e]={ctxMenu:n,handler:d,config:r},a.addEventListener("contextmenu",d)}else console.error("target element ".concat(e," not found"));else console.error("target element ".concat(e," already has a context menu assigned. Use ContextMenu.update() intstead."))},i.prototype.update=function(t,n,o){if(void 0===o&&(o={}),"function"==typeof o)return this.update(t,n,{onBeforeShow:o});var i=this.cache[t],r=e(e({},null==i?void 0:i.config),o),a=document.querySelector(t);i&&(null==a||a.removeEventListener("contextmenu",i.handler)),delete this.cache[t],this.attach(t,n||(null==i?void 0:i.ctxMenu)||[],r)},i.prototype.delete=function(e){var t=this.cache[e];if(t){var n=document.querySelector(e);n?(n.removeEventListener("contextmenu",t.handler),delete this.cache[e]):console.error("target element ".concat(e," does not exist (anymore)"))}else console.error("no context menu for target element ".concat(e," found"))},i.prototype.show=function(e,n,o){var i=this;n instanceof MouseEvent&&n.stopImmediatePropagation(),this.hide();var r=this.getConfig(o);this.onHide=r.onHide,this.onBeforeHide=r.onBeforeHide,this.menu=this.generateDOM(t([],e,!0),n),document.body.appendChild(this.menu),r.onShow(this.menu),this.menu.addEventListener("wheel",(function(){i.preventCloseOnScroll=!0}),{passive:!0}),n instanceof MouseEvent&&n.preventDefault()},i.prototype.hide=function(e){var t,n,o;void 0===e&&(e=this.menu),null===(t=this.onBeforeHide)||void 0===t||t.call(this,e),u="r",l="d",e&&(e===this.menu&&delete this.menu,null===(n=e.parentElement)||void 0===n||n.removeChild(e)),null===(o=this.onHide)||void 0===o||o.call(this,e),this.onBeforeHide=void 0,this.onHide=void 0},i.prototype.getConfig=function(t){return void 0===t&&(t={}),e({onBeforeShow:function(e){return e},onBeforeHide:function(){},onShow:function(){},onHide:function(){}},t)},i.prototype.generateDOM=function(e,t){var i=this,r=document.createElement("ul");return 0===e.length&&(r.style.display="none"),e.forEach((function(e){var t=s(e);d(t,(function(){var e,n=null===(e=t.parentElement)||void 0===e?void 0:e.querySelector("ul");n&&n.parentElement!==t&&i.hide(n)})),o(e)&&!c(e)&&(a(e)?d(t,(function(o){t.querySelector("ul")||i.openSubMenu(o,n(e.subMenu),t)})):t.addEventListener("click",(function(){i.hide()}))),r.appendChild(t)})),r.className="ctxmenu",h(r,t),r.addEventListener("contextmenu",(function(e){e.stopPropagation(),e.preventDefault()})),r.addEventListener("click",(function(e){var t=e.target instanceof Element&&e.target.parentElement;t&&"interactive"!==t.className&&e.stopPropagation()})),r},i.prototype.openSubMenu=function(e,t,n){var o,i=null===(o=n.parentElement)||void 0===o?void 0:o.querySelector("li > ul");i&&i.parentElement!==n&&this.hide(i),n.appendChild(this.generateDOM(t,n))},i.addStylesToDom=function(){var e=function(){if("loading"===document.readyState)return document.addEventListener("readystatechange",(function(){e()}));var t=document.createElement("style");t.innerHTML='html{min-height:100%}.ctxmenu{position:fixed;border:1px solid #999;padding:2px 0;box-shadow:#aaa 3px 3px 3px;background:#fff;margin:0;z-index:9999;overflow-y:auto;font:15px Verdana, sans-serif;box-sizing:border-box}.ctxmenu li{margin:1px 0;display:block;position:relative;user-select:none}.ctxmenu li.heading{font-weight:bold;margin-left:-5px}.ctxmenu li span{display:block;padding:2px 20px;cursor:default}.ctxmenu li a{color:inherit;text-decoration:none}.ctxmenu li.icon{padding-left:15px}.ctxmenu img.icon{position:absolute;width:18px;left:10px;top:2px}.ctxmenu li.disabled{color:#ccc}.ctxmenu li.divider{border-bottom:1px solid #aaa;margin:5px 0}.ctxmenu li.interactive:hover{background:rgba(0, 0, 0, .1)}.ctxmenu li.submenu::after{content:"";position:absolute;display:block;top:0;bottom:0;right:.4em;margin:auto .1rem auto auto;border-right:1px solid #000;border-top:1px solid #000;transform:rotate(45deg);width:.3rem;height:.3rem}.ctxmenu li.submenu.disabled::after{border-color:#ccc}',document.head.insertBefore(t,document.head.childNodes[0]),e=function(){}};e()},i}().getInstance();
/*! ctxMenu v1.6.2 | (c) Nikolaj Kappler | https://github.com/nkappler/ctxmenu/blob/master/LICENSE !*/exports.ctxmenu=v;
